<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Sedan Configurator</title>
    <link rel="stylesheet">
    <script src="https://scripts.sirv.com/sirvjs/v3/sirv.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        .main-div {
                display: flex;
                flex-direction: column;
                gap: 40px;
                padding: 20px;
                align-items: center;
            }

            .section {
                background-color: #F1EFEC;
                display: flex;
                justify-content: space-between;
                height: 500px;
                width: 1500px;
                border-radius: 50px;
            }

            .left {
                width: 70%;
                background-color: #F1EFEC;
                text-align: left;
                border-radius: 50px;
            }

            .right {
                display: flex;
                align-items: center;
                flex-direction: column;
                justify-content: center;
                width: 30%;
                background-color: #0A1828;
                color: #BFA181;
                padding: 10px;
                text-align: center;
                border-radius: 50px;
            }

            .submit-button {
                background-color: #0A1828;
                color: #BFA181;
                border-radius: 9999px;
                padding: 10px 20px;
                border: none;
                font-weight: bold;
                margin: auto;
                display: block;
                scale:1.2;
            }

            #interiorImage {
                max-width: 100%;
                max-height: 100%;
                display: block;
                margin: auto;
                object-fit: contain;
            }

            #engineImage {
                max-width: 100%;
                max-height: 100%;
                display: block;
                margin: auto;
                object-fit: contain;
            }
    </style>

</head>
<body>


<form th:action="@{/configurator/sedan}" th:object="${carConfiguratorForm}" method="post">

    <div class="main-div">

        <div class="section">
            <div class="left">
                <div id="carSpin" class="Sirv" data-src="https://mariantoma.sirv.com/Elyssion_sedan/red_sedan/red_sedan.spin"></div>
            </div>

            <div class="right">
                <div class="exterior-color-div" th:each="exterior : ${availableExteriorOptions}">
                    <label>
                        <input type="radio" th:field="*{exteriorColor}" th:value="${exterior.name()}"
                               th:attr="data-color=${exterior.name()}"
                               onclick="changeColorFromData(this); enableSubmit()"
                               required>
                        <span th:text="${exterior.description} + ' (' + ${exterior.optionPrice} + ' ' + Euro + ')'"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="left">
                <img id="interiorImage" class="Sirv" data-src="https://mariantoma.sirv.com/interior/black.webp" alt="Interior View">
            </div>

            <div class="right">
                <div th:each="interior : ${availableInteriorOptions}">
                    <label>
                        <input type="radio" th:field="*{interiorColor}" th:value="${interior.name()}"
                               th:attr="data-color=${interior.name()}"
                               onclick="changeInteriorImage(this.dataset.color); enableSubmit()"
                               required>
                        <span th:text="${interior.description} + ' (' + ${interior.optionPrice} + ' ' + Euro + ')'"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="left">
                <img id="engineImage" class="Sirv" src="https://mariantoma.sirv.com/Engine_type/2.0%20TSX.png" alt="Engine View">
            </div>

            <div class="right">
                <div th:each="engine : ${availableEngineTypes}">
                    <label>
                        <input type="radio" th:field="*{engineType}" th:value="${engine.name()}"
                               th:attr="data-engine=${engine.name()}"
                               onclick="changeEngineImage(this.dataset.engine); enableSubmit()"
                               required>
                        <span th:text="${engine.description} + ' (' + ${engine.optionPrice} + ' ' + Euro + ')'"></span>
                    </label>
                </div>
            </div>
        </div>

            <input type="hidden" th:field="*{finalPrice}" th:value="${calculatedFinalPrice}"/>

            <button class="submit-button" type="submit">Submit</button>
    </div>
</form>

<script>
    const colorSpinMap = {
        RED: "https://mariantoma.sirv.com/Elyssion_sedan/red_sedan/red_sedan.spin",
        BLUE: "https://mariantoma.sirv.com/Elyssion_sedan/blue_sedan/blue_sedan.spin",
        BLACK: "https://mariantoma.sirv.com/Elyssion_sedan/black_sedan/black_sedan.spin",
        SILVER: "https://mariantoma.sirv.com/Elyssion_sedan/silver_sedan/silver_sedan.spin",
        GREEN: "https://mariantoma.sirv.com/Elyssion_sedan/green_sedan/green_sedan.spin"
    };

    function changeColorFromData(element) {
        const colorKey = element.dataset.color;
        changeSpin(colorKey);
    }

    function changeSpin(colorKey) {
        const newUrl = colorSpinMap[colorKey];
        const oldSpinDiv = document.getElementById("carSpin");

        if (oldSpinDiv && newUrl) {
            const newSpinDiv = document.createElement("div");
            newSpinDiv.id = "carSpin";
            newSpinDiv.className = "Sirv";
            newSpinDiv.setAttribute("data-src", newUrl);

            oldSpinDiv.parentNode.replaceChild(newSpinDiv, oldSpinDiv);
            Sirv.start();
        } else {
            console.warn("The spin could not be updated. Check the colorKey or the element.");
        }
    }

    const interiorImageMap = {
    BLACK: "https://mariantoma.sirv.com/interior/black.webp",
    TAN: "https://mariantoma.sirv.com/interior/tan.webp",
    WHITE: "https://mariantoma.sirv.com/interior/white.jpg"
};

    function changeInteriorImage(colorKey) {
        const newUrl = interiorImageMap[colorKey];
        const interiorImg = document.getElementById("interiorImage");

        if (interiorImg && newUrl) {
            interiorImg.setAttribute("src", newUrl);
            Sirv.start();
        } else {
            console.warn("Could not update interior image. Check colorKey:", colorKey);
        }
};

    const engineImageMap = {
    PETROL_2_0_TSX: "https://mariantoma.sirv.com/Engine_type/2.0%20TSX.png",
    DIESEL_1_6_TDI: "https://mariantoma.sirv.com/Engine_type/2.0%20TDX.png"
};

    function changeEngineImage(engineKey) {
    const newUrl = engineImageMap[engineKey];
    const engineImg = document.getElementById("engineImage");

    if (engineImg && newUrl) {
        engineImg.setAttribute("src", newUrl);
    } else {
        console.warn("Could not update engine image. Check engineKey:", engineKey);
    }
};

    function enableSubmit() {
        const submitButton = document.getElementById("submitButton");
        if (submitButton) {
            submitButton.disabled = false;
        }
    }
</script>

</body>
</html>